(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[79],{2770:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(5155);a(2115);var s=a(5695);let n=()=>{let e=(0,s.useRouter)(),t="/"===(0,s.usePathname)();return(0,r.jsx)("header",{className:"fixed top-0 left-0 right-0 z-50 w-full max-w-xl mx-auto h-[70px] bg-[#F9F9F9] border-b border-[#777] flex items-center justify-center select-none",children:(0,r.jsxs)("div",{className:"w-full max-w-xl flex items-center justify-between px-5 relative",children:[(0,r.jsxs)("button",{onClick:()=>e.back(),className:"bg-none border-none text-[20px] cursor-pointer text-black  p-0 flex items-center transition-opacity duration-200 ".concat(t?"opacity-0 pointer-events-none":"opacity-100"),"aria-hidden":t,tabIndex:t?-1:0,children:["<"," ",(0,r.jsx)("span",{className:"ml-1 hidden sm:inline",children:"Back"})]}),(0,r.jsx)("h1",{className:"absolute left-1/2 transform -translate-x-1/2 text-[20px] font-bold text-black text-center cursor-pointer select-none m-0",onClick:()=>e.push("/"),children:"USTB"}),(0,r.jsx)("div",{className:"w-[60px]"})]})})}},3693:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var r=a(5155),s=a(2115),n=a(5695),l=a(5317),c=a(8396),i=a(2770),o=a(7145);function d(){let{chatId:e}=(0,n.useParams)(),t=(0,n.useRouter)(),[a,d]=(0,s.useState)([]),[u,m]=(0,s.useState)(""),h=(0,s.useRef)(null),x=()=>{var e;null==(e=h.current)||e.scrollIntoView({behavior:"smooth"})};(0,s.useEffect)(()=>{if(!e)return;let t=(0,l.P)((0,l.rJ)(c.db,"chats",e,"messages"),(0,l.My)("created_at","asc")),a=(0,l.aQ)(t,e=>{d(e.docs.map(e=>({id:e.id,...e.data()}))),x()});return()=>a()},[e]),(0,s.useEffect)(()=>{if(!e||!c.j.currentUser)return;let t=c.j.currentUser.uid;(async()=>{let a=(0,l.P)((0,l.rJ)(c.db,"chats",e,"messages"),(0,l._M)("read","==",!1));(await (0,l.GG)(a)).forEach(async a=>{a.data().sender_uid!==t&&await (0,l.mZ)((0,l.H9)(c.db,"chats",e,"messages",a.id),{read:!0})})})()},[e]);let p=async()=>{if(u.trim())try{var t;await (0,l.gS)((0,l.rJ)(c.db,"chats",e,"messages"),{sender_uid:null==(t=c.j.currentUser)?void 0:t.uid,content:u.trim(),created_at:(0,l.O5)(),read:!1}),await (0,l.mZ)((0,l.H9)(c.db,"chats",e),{last_message:u.trim(),last_message_at:(0,l.O5)()}),m(""),x()}catch(e){console.error("Message failed to send:",e)}},b=async()=>{if(window.confirm("Are you sure you want to leave this chat room?")&&c.j.currentUser)try{let a=c.j.currentUser.uid,r=(0,l.H9)(c.db,"chats",e);await (0,l.mZ)(r,{["user1_uid"===a?"user1_exited":"user2_exited"]:!0}),t.push("/chat")}catch(e){console.error("Failed to leave the chat room:",e),alert("An error occurred while leaving the chat room.")}};return(0,r.jsxs)("div",{className:"pt-[70px] pb-[60px] max-w-xl mx-auto min-h-screen bg-white flex flex-col",children:[(0,r.jsx)(i.A,{}),(0,r.jsxs)("main",{className:"flex-1 overflow-y-auto p-5",children:[a.map(e=>{var t,a;return(0,r.jsx)("div",{className:"flex ".concat(e.sender_uid===(null==(t=c.j.currentUser)?void 0:t.uid)?"justify-end":"justify-start"," mb-2"),children:(0,r.jsx)("div",{className:"max-w-[70%] p-2 rounded-md text-sm ".concat(e.sender_uid===(null==(a=c.j.currentUser)?void 0:a.uid)?"bg-yellow-300 text-right":"bg-gray-200 text-left"),children:e.content})},e.id)}),(0,r.jsx)("div",{ref:h})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 p-4 border-t",children:[(0,r.jsx)("input",{type:"text",value:u,onChange:e=>m(e.target.value),placeholder:"Please enter a message",className:"flex-1 p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400"}),(0,r.jsx)("button",{onClick:p,className:"bg-yellow-400 hover:bg-yellow-500 text-white font-bold py-2 px-4 rounded",children:"Send"})]}),(0,r.jsx)("div",{className:"p-4",children:(0,r.jsx)("button",{onClick:b,className:"w-full bg-red-400 hover:bg-red-500 text-white font-bold py-2 rounded",children:"Leave Chat Room"})}),(0,r.jsx)(o.A,{})]})}},3765:(e,t,a)=>{Promise.resolve().then(a.bind(a,3693))},7145:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var r=a(5155);a(2115);var s=a(5695),n=a(8396);let l=[{id:1,label:"HOME",path:"/"},{id:2,label:"Community",path:"/community"},{id:3,label:"Chat",path:"/chatlist",requireAuth:!0},{id:5,label:"MY",path:"/mypage",requireAuth:!0}],c=()=>{let e=(0,s.useRouter)(),t=(0,s.usePathname)(),a=t=>{t.requireAuth&&!n.j.currentUser?e.push("/login"):e.push(t.path)};return(0,r.jsx)("nav",{className:"fixed bottom-0 left-0 right-0 z-50 w-full max-w-xl mx-auto h-[60px] bg-[#f8f8f8] border-t-2 border-[#cecece] flex justify-around items-center select-none",children:l.map(e=>{let s=t===e.path||"/"!==e.path&&t.startsWith(e.path);return(0,r.jsxs)("button",{onClick:()=>a(e),"aria-label":e.label,className:"flex flex-col items-center justify-center flex-1 max-w-[150px] bg-none border-none outline-none",type:"button",children:[(0,r.jsx)("div",{className:"w-6 h-6 rounded-full border-2 flex items-center justify-center mb-1 ".concat(s?"border-orange-500 bg-orange-500":"border-gray-400 bg-transparent")}),(0,r.jsx)("span",{className:"text-[10px] text-[#777] select-none",children:e.label})]},e.id)})})}},8396:(e,t,a)=>{"use strict";a.d(t,{db:()=>c,h:()=>o,j:()=>i});var r=a(3915),s=a(5317),n=a(6203);let l=(0,r.Wp)({apiKey:"AIzaSyDSTAcpdQ-fDPw10h9wz3y_cS-bywHgVAY",authDomain:"community-chat-app-68996.firebaseapp.com",projectId:"community-chat-app-68996",storageBucket:"community-chat-app-68996.appspot.com",messagingSenderId:"523216978134",appId:"1:523216978134:web:a4bae7b951e880a7f78977",measurementId:"G-3VB219MYP1"}),c=(0,s.aU)(l),i=(0,n.xI)(l),o=new n.HF}},e=>{var t=t=>e(e.s=t);e.O(0,[992,158,678,441,684,358],()=>t(3765)),_N_E=e.O()}]);